<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Calendar | FreeBizTools</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .day {
            background-color: #ffffff;
            height: 120px;
            position: relative;
            padding: 0.5rem;
            overflow: hidden;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .day:hover {
            background-color: #f3f4f6;
        }
        .day.inactive {
            background-color: #f9fafb;
            color: #d1d5db;
            cursor: not-allowed;
        }
        .day-header {
            background-color: #f3f4f6;
            text-align: center;
            font-weight: 600;
            padding: 0.75rem 0;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .event-item {
            background-color: #6366f1;
            color: white;
            padding: 0.25rem;
            margin-top: 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .modal.open {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            position: relative;
        }
        .close-button {
            position: absolute;
            top: 0.5rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: #9ca3af;
        }
    </style>
</head>
<body>

     <a href="https://freebiztools.xyz"
       class="absolute top-4 left-4 text-gray-800 hover:text-gray-900 transition duration-200 font-semibold">
        &larr; Back to Home
    </a>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 md:px-12 lg:px-24">
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Marketing Calendar</h1>
            <p class="text-gray-600 mb-6">Plan and track your marketing activities throughout the month.</p>

            <!-- Calendar Navigation -->
            <div class="flex justify-between items-center mb-6">
                <button id="prevMonth" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition duration-200">&lt; Prev</button>
                <h2 id="currentMonthYear" class="text-2xl font-semibold text-gray-800"></h2>
                <button id="nextMonth" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition duration-200">Next &gt;</button>
            </div>
            
            <!-- Calendar Grid -->
            <div id="calendar-grid" class="calendar-grid mb-6">
                <!-- Day cells will be dynamically generated here -->
            </div>
        </div>
    </main>

    <!-- Event Modal Form -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="modalCloseBtn">&times;</span>
            <h3 id="modalTitle" class="text-xl font-bold mb-4">Add Event</h3>
            <form id="eventForm" class="space-y-4">
                <div>
                    <label for="eventTitle" class="block text-gray-700 font-medium mb-1">Event Title</label>
                    <input type="text" id="eventTitle" class="w-full p-2 border border-gray-300 rounded-md" placeholder="e.g., 'Email Newsletter'" required>
                </div>
                <div>
                    <label for="eventDescription" class="block text-gray-700 font-medium mb-1">Description</label>
                    <textarea id="eventDescription" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Briefly describe the event"></textarea>
                </div>
                <div>
                    <label for="eventChannel" class="block text-gray-700 font-medium mb-1">Channel</label>
                    <input type="text" id="eventChannel" class="w-full p-2 border border-gray-300 rounded-md" placeholder="e.g., 'Email', 'Social Media'">
                </div>
                <input type="hidden" id="eventDate">
                <input type="hidden" id="eventId">
                <div class="flex justify-end gap-2">
                    <button type="submit" id="saveEventBtn" class="bg-gray-800 text-white px-4 py-2 rounded-lg shadow-md hover:bg-gray-700 transition duration-200">Save</button>
                    <button type="button" id="deleteEventBtn" class="hidden bg-red-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-600 transition duration-200">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">Confirm Deletion</h3>
            <p class="text-gray-700 mb-6">Are you sure you want to delete this event?</p>
            <div class="flex justify-end gap-2">
                <button type="button" id="cancelDeleteBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg shadow-md hover:bg-gray-300 transition duration-200">Cancel</button>
                <button type="button" id="confirmDeleteBtn" class="bg-red-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-red-600 transition duration-200">Delete</button>
            </div>
        </div>
    </div>


    <script>
        // --- UI Element Selectors ---
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const eventModal = document.getElementById('eventModal');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalTitle = document.getElementById('modalTitle');
        const eventForm = document.getElementById('eventForm');
        const eventTitleInput = document.getElementById('eventTitle');
        const eventDescriptionInput = document.getElementById('eventDescription');
        const eventChannelInput = document.getElementById('eventChannel');
        const eventDateInput = document.getElementById('eventDate');
        const eventIdInput = document.getElementById('eventId');
        const deleteEventBtn = document.getElementById('deleteEventBtn');
        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        // --- App State ---
        let currentMonth = new Date();
        let events = []; // Array to hold all events
        const storageKey = 'marketing_events_v1'; // Key for localStorage

        /**
         * Loads events from localStorage.
         * @returns {Array} An array of event objects.
         */
        const loadEventsFromLocalStorage = () => {
            try {
                const storedEvents = localStorage.getItem(storageKey);
                if (storedEvents) {
                    // Parse the JSON string and convert date strings back to Date objects
                    const parsedEvents = JSON.parse(storedEvents);
                    // Adjust to create Date objects from year, month, day to avoid timezone issues
                    return parsedEvents.map(event => {
                        const newDate = new Date(event.year, event.month, event.day);
                        return {
                            ...event,
                            date: newDate
                        };
                    });
                }
            } catch (e) {
                console.error("Failed to load events from local storage:", e);
                return [];
            }
            return [];
        };

        /**
         * Saves the current events array to localStorage.
         */
        const saveEventsToLocalStorage = () => {
            try {
                // Convert date objects to ISO strings before saving
                const eventsToSave = events.map(event => ({
                    id: event.id,
                    title: event.title,
                    description: event.description,
                    channel: event.channel,
                    // Store year, month, and day separately to avoid timezone issues
                    year: event.date.getFullYear(),
                    month: event.date.getMonth(),
                    day: event.date.getDate()
                }));
                localStorage.setItem(storageKey, JSON.stringify(eventsToSave));
            } catch (e) {
                console.error("Failed to save events to local storage:", e);
            }
        };

        /**
         * Saves a new or updates an existing event.
         * @param {object} eventData The event data to save.
         */
        const saveEvent = (eventData) => {
            // Parse the date string into year, month, and day
            const [year, month, day] = eventData.date.split('-').map(Number);
            const newDate = new Date(year, month - 1, day); // month is 0-indexed in JS Date

            if (eventData.id) {
                // Update existing event
                const index = events.findIndex(e => e.id === eventData.id);
                if (index !== -1) {
                    events[index] = {
                        id: eventData.id,
                        title: eventData.title,
                        description: eventData.description,
                        channel: eventData.channel,
                        date: newDate
                    };
                }
            } else {
                // Add new event
                const newEvent = {
                    id: Date.now().toString(), // Simple unique ID
                    title: eventData.title,
                    description: eventData.description,
                    channel: eventData.channel,
                    date: newDate
                };
                events.push(newEvent);
            }
            saveEventsToLocalStorage();
            renderCalendar();
        };
        
        /**
         * Deletes an event.
         * @param {string} eventId The ID of the event to delete.
         */
        const deleteEvent = (eventId) => {
            events = events.filter(event => event.id !== eventId);
            saveEventsToLocalStorage();
            renderCalendar();
        };

        /**
         * Renders the calendar grid based on the current month and available events.
         */
        const renderCalendar = () => {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            currentMonthYear.textContent = `${currentMonth.toLocaleString('default', { month: 'long' })} ${year}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDayIndex = firstDay.getDay(); // 0 for Sunday, 1 for Monday, etc.
            const totalDays = lastDay.getDate();

            calendarGrid.innerHTML = `
                <div class="day-header">Sun</div>
                <div class="day-header">Mon</div>
                <div class="day-header">Tue</div>
                <div class="day-header">Wed</div>
                <div class="day-header">Thu</div>
                <div class="day-header">Fri</div>
                <div class="day-header">Sat</div>
            `;

            // Render inactive days from the previous month
            for (let i = 0; i < startDayIndex; i++) {
                const prevMonthDay = document.createElement('div');
                prevMonthDay.classList.add('day', 'inactive');
                prevMonthDay.innerHTML = `<span class="text-sm font-semibold text-gray-400"></span>`; 
                calendarGrid.appendChild(prevMonthDay);
            }

            // Render active days
            for (let day = 1; day <= totalDays; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('day', 'flex', 'flex-col');
                const date = new Date(year, month, day);
                
                dayDiv.innerHTML = `<span class="text-sm font-semibold text-gray-900">${day}</span>`;
                
                // Add click listener for adding a new event
                dayDiv.addEventListener('click', () => {
                    openModal(date);
                });

                // Add events for this day
                const dayEvents = events.filter(e => {
                    const eventDate = e.date;
                    return eventDate.getFullYear() === year && eventDate.getMonth() === month && eventDate.getDate() === day;
                });
                
                dayEvents.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.classList.add('event-item');
                    eventDiv.textContent = event.title;
                    eventDiv.dataset.eventId = event.id; // Store ID for editing
                    
                    // Add click listener for editing an existing event
                    eventDiv.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent the day's click event from firing
                        openModal(null, event);
                    });

                    dayDiv.appendChild(eventDiv);
                });

                calendarGrid.appendChild(dayDiv);
            }
        };

        /**
         * Opens the event modal for adding or editing an event.
         * @param {Date|null} date The date for a new event.
         * @param {object|null} event The existing event data to edit.
         */
        const openModal = (date, event = null) => {
            eventForm.reset();
            eventIdInput.value = '';
            deleteEventBtn.classList.add('hidden');
            
            if (event) {
                modalTitle.textContent = 'Edit Event';
                eventTitleInput.value = event.title;
                eventDescriptionInput.value = event.description || '';
                eventChannelInput.value = event.channel || '';
                // Format the date correctly to avoid timezone issues
                const year = event.date.getFullYear();
                const month = (event.date.getMonth() + 1).toString().padStart(2, '0');
                const day = event.date.getDate().toString().padStart(2, '0');
                eventDateInput.value = `${year}-${month}-${day}`;

                eventIdInput.value = event.id;
                deleteEventBtn.classList.remove('hidden');
            } else {
                modalTitle.textContent = 'Add New Event';
                // Format the date correctly for new events
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                eventDateInput.value = `${year}-${month}-${day}`;
            }
            
            eventModal.classList.add('open');
        };

        /**
         * Closes the event modal.
         */
        const closeModal = () => {
            eventModal.classList.remove('open');
        };

        /**
         * Opens the deletion confirmation modal.
         * @param {string} eventId The ID of the event to delete.
         */
        const openDeleteModal = (eventId) => {
            confirmDeleteBtn.dataset.eventId = eventId;
            deleteConfirmModal.classList.add('open');
        };

        /**
         * Closes the deletion confirmation modal.
         */
        const closeDeleteModal = () => {
            deleteConfirmModal.classList.remove('open');
            confirmDeleteBtn.dataset.eventId = null;
        };

        // --- Event Listeners ---
        prevMonthBtn.addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        });

        eventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const eventData = {
                title: eventTitleInput.value,
                description: eventDescriptionInput.value,
                channel: eventChannelInput.value,
                date: eventDateInput.value,
                id: eventIdInput.value || null
            };
            saveEvent(eventData);
            closeModal();
        });

        deleteEventBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openDeleteModal(eventIdInput.value);
            closeModal();
        });
        
        // Confirmation modal buttons
        cancelDeleteBtn.addEventListener('click', closeDeleteModal);
        confirmDeleteBtn.addEventListener('click', () => {
            const eventId = confirmDeleteBtn.dataset.eventId;
            if (eventId) {
                deleteEvent(eventId);
            }
            closeDeleteModal();
        });

        modalCloseBtn.addEventListener('click', closeModal);

        // Initial setup on window load
        window.addEventListener('load', () => {
            events = loadEventsFromLocalStorage();
            renderCalendar();
        });
    </script>
</body>
</html>
