<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Tool</title>
    <!-- Inter Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        .sort-header {
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        .sort-header .arrow {
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            display: inline-block;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen p-4 flex items-center justify-center">

    <!-- Main container with a professional light theme -->
    <div class="container max-w-5xl mx-auto space-y-8 p-6 lg:p-12 bg-white rounded-2xl shadow-2xl animate-fadeIn">
        <header class="text-center">
            <h1 class="text-4xl lg:text-5xl font-bold text-gray-900">Project Management</h1>
            <p class="mt-2 text-gray-600">Manage your tasks and deadlines efficiently.</p>
        </header>
        
        <!-- The "Back to Home" link has been moved inside the container and restyled. -->
        <a href="https://yeamin710.github.io/freebiztools/index.html"
           class="flex items-center space-x-2 text-gray-600 hover:text-sky-600 font-semibold
                  transition duration-200 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Home</span>
        </a>

        <!-- Project Summary Section -->
        <section class="bg-gray-200 p-6 rounded-xl shadow-inner border border-gray-300">
            <h2 class="text-2xl font-semibold text-gray-800">Project Summary</h2>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                    <span class="text-lg font-medium text-gray-700">Total Tasks:</span>
                    <span id="total-tasks" class="text-2xl font-bold text-sky-500">0</span>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                    <span class="text-lg font-medium text-gray-700">In Progress:</span>
                    <span id="in-progress-tasks" class="text-2xl font-bold text-yellow-500">0</span>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                    <span class="text-lg font-medium text-gray-700">Completed:</span>
                    <span id="completed-tasks" class="text-2xl font-bold text-green-500">0</span>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between">
                    <span class="text-lg font-medium text-gray-700">Cancelled:</span>
                    <span id="cancelled-tasks" class="text-2xl font-bold text-gray-500">0</span>
                </div>
            </div>
        </section>

        <!-- Add New Task Form Section -->
        <section class="bg-gray-200 p-6 rounded-xl shadow-inner border border-gray-300">
            <h2 class="text-2xl font-semibold text-gray-800">Add New Task</h2>
            <form id="task-form" class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <input type="text" id="task-title" placeholder="Task Title" required
                        class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
                <div>
                    <input type="date" id="task-due-date" required
                        class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
                <div>
                    <input type="text" id="task-assignee" placeholder="Assigned to"
                        class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
                <div class="md:col-span-2">
                    <textarea id="task-description" placeholder="Task Description" rows="2"
                        class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                </div>
                <div class="md:col-span-1">
                    <select id="task-priority"
                        class="w-full px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <option value="Low">Low Priority</option>
                        <option value="Medium">Medium Priority</option>
                        <option value="High">High Priority</option>
                    </select>
                </div>
                <div class="md:col-span-4 flex justify-end">
                    <button type="submit"
                        class="px-6 py-3 bg-gray-700 text-white font-semibold rounded-lg shadow-md hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-offset-2 transition-transform transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>Add Task
                    </button>
                </div>
            </form>
        </section>

        <!-- Task List Section -->
        <section class="bg-gray-200 p-6 rounded-xl shadow-inner border border-gray-300">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4 md:mb-0">Current Tasks</h2>
                <div class="flex space-x-2 w-full md:w-auto">
                    <select id="status-filter"
                        class="px-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                        <option value="all">All</option>
                        <option value="To Do">To Do</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                        <option value="Bin">Bin</option>
                    </select>
                    <input type="text" id="search-tasks" placeholder="Search tasks..."
                        class="w-full pl-10 pr-4 py-2 rounded-lg bg-white border border-gray-300 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-sky-500">
                </div>
            </div>
            
            <div class="overflow-x-auto rounded-lg shadow-md">
                <table class="min-w-full divide-y divide-gray-300">
                    <thead class="bg-gray-300">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider sort-header" data-sort-by="title">
                                Task <span class="arrow"></span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider">Assigned To</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider sort-header" data-sort-by="dueDate">
                                Due Date <span class="arrow"></span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider sort-header" data-sort-by="daysRemaining">
                                Days Remaining <span class="arrow"></span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider sort-header" data-sort-by="priority">
                                Priority <span class="arrow"></span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-800 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="task-list">
                        <!-- Tasks will be inserted here by JavaScript -->
                        <tr>
                            <td colspan="7" class="px-6 py-4 text-center text-gray-500">No tasks found.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Edit Task Modal -->
        <div id="edit-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden modal opacity-0">
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-lg transform transition-transform scale-95">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Edit Task</h3>
                <form id="edit-task-form" class="space-y-4">
                    <div>
                        <label for="edit-task-title" class="block text-sm font-medium text-gray-700">Task Title</label>
                        <input type="text" id="edit-task-title" required class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                    </div>
                    <div>
                        <label for="edit-task-description" class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="edit-task-description" rows="3" class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="edit-task-due-date" class="block text-sm font-medium text-gray-700">Due Date</label>
                            <input type="date" id="edit-task-due-date" required class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                        </div>
                        <div>
                            <label for="edit-task-assignee" class="block text-sm font-medium text-gray-700">Assigned To</label>
                            <input type="text" id="edit-task-assignee" class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                        </div>
                    </div>
                    <div>
                        <label for="edit-task-priority" class="block text-sm font-medium text-gray-700">Priority</label>
                        <select id="edit-task-priority" class="mt-1 block w-full px-4 py-2 rounded-lg bg-gray-100 border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-sky-500">
                            <option value="Low">Low Priority</option>
                            <option value="Medium">Medium Priority</option>
                            <option value="High">High Priority</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-3">
                        <button type="button" id="cancel-edit-btn" class="px-4 py-2 text-white bg-gray-700 rounded-lg hover:bg-gray-800">Cancel</button>
                        <button type="submit" id="save-edit-btn" class="px-4 py-2 text-white bg-sky-500 rounded-lg hover:bg-sky-600">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden modal opacity-0">
            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm transform transition-transform scale-95">
                <h3 class="text-xl font-bold text-gray-900 mb-4">Confirm Deletion</h3>
                <p class="text-gray-700 mb-6">Are you sure you want to delete this task? This action cannot be undone.</p>
                <div class="flex justify-end gap-3">
                    <button id="cancel-delete-btn" class="px-4 py-2 text-white bg-gray-700 rounded-lg hover:bg-gray-800">Cancel</button>
                    <button id="confirm-delete-btn" class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700">Delete</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('task-form');
            const taskList = document.getElementById('task-list');
            const searchInput = document.getElementById('search-tasks');
            const statusFilter = document.getElementById('status-filter');
            const totalTasksEl = document.getElementById('total-tasks');
            const inProgressTasksEl = document.getElementById('in-progress-tasks');
            const completedTasksEl = document.getElementById('completed-tasks');
            const cancelledTasksEl = document.getElementById('cancelled-tasks');
            const deleteModal = document.getElementById('delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

            // New elements for edit functionality
            const editModal = document.getElementById('edit-modal');
            const editForm = document.getElementById('edit-task-form');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            
            let tasks = [];
            let taskToDeleteId = null;
            let taskToEditId = null;
            let currentSortColumn = 'title';
            let sortDirection = 'asc';

            // Helper function to format date from yyyy-mm-dd to dd-mm-yyyy or dd/mm/yyyy
            const formatDate = (dateString, separator = '-') => {
                if (!dateString) return '';
                const [year, month, day] = dateString.split('-');
                return `${day}${separator}${month}${separator}${year}`;
            };
            
            // Load tasks from localStorage on page load
            const loadTasks = () => {
                const storedTasks = localStorage.getItem('tasks');
                if (storedTasks) {
                    try {
                        tasks = JSON.parse(storedTasks);
                    } catch (e) {
                        console.error('Failed to parse tasks from localStorage:', e);
                        tasks = [];
                    }
                }
                renderTasks();
            };

            // Save tasks to localStorage
            const saveTasks = () => {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            };

            // Update the summary dashboard
            const updateSummary = () => {
                const total = tasks.length;
                const inProgress = tasks.filter(task => task.status === 'In Progress').length;
                const completed = tasks.filter(task => task.status === 'Completed').length;
                const cancelled = tasks.filter(task => task.status === 'Bin').length;
                
                totalTasksEl.textContent = total;
                inProgressTasksEl.textContent = inProgress;
                completedTasksEl.textContent = completed;
                cancelledTasksEl.textContent = cancelled;
            };

            // Get the appropriate priority badge color class
            const getPriorityBadgeClass = (priority) => {
                switch (priority) {
                    case 'High':
                        return 'bg-red-500 text-white';
                    case 'Medium':
                        return 'bg-yellow-500 text-gray-900';
                    case 'Low':
                        return 'bg-green-500 text-white';
                    default:
                        return 'bg-gray-400 text-white';
                }
            };
            
            // Function to sort tasks
            const sortTasks = (tasks, sortBy, direction) => {
                const priorityOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                const oneDay = 1000 * 60 * 60 * 24;
                const today = new Date();

                return tasks.sort((a, b) => {
                    let aVal, bVal;
                    let aDaysRemaining, bDaysRemaining;

                    if (sortBy === 'priority') {
                        aVal = priorityOrder[a.priority] || 0;
                        bVal = priorityOrder[b.priority] || 0;
                    } else if (sortBy === 'dueDate') {
                        aVal = new Date(a.dueDate).getTime();
                        bVal = new Date(b.dueDate).getTime();
                    } else if (sortBy === 'daysRemaining') {
                        // Days remaining sorting logic
                        aDaysRemaining = Math.ceil((new Date(a.dueDate).getTime() - today.getTime()) / oneDay);
                        bDaysRemaining = Math.ceil((new Date(b.dueDate).getTime() - today.getTime()) / oneDay);
                        // Sort cancelled and completed tasks to the end
                        if (a.status === 'Bin' || a.status === 'Completed') return 1;
                        if (b.status === 'Bin' || b.status === 'Completed') return -1;
                        
                        aVal = aDaysRemaining;
                        bVal = bDaysRemaining;
                    } else { // Default to title
                        aVal = a[sortBy];
                        bVal = b[sortBy];
                    }

                    if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                    return 0;
                });
            };

            // Render the task list
            const renderTasks = (filteredTasks = tasks) => {
                // First, sort the tasks
                const sortedTasks = sortTasks(filteredTasks, currentSortColumn, sortDirection);
                
                taskList.innerHTML = ''; // Clear existing list
                updateSummary();

                if (sortedTasks.length === 0) {
                    const noItemsRow = `
                        <tr>
                            <td colspan="7" class="px-6 py-4 text-center text-gray-500">No tasks found.</td>
                        </tr>
                    `;
                    taskList.innerHTML = noItemsRow;
                    return;
                }
                
                const today = new Date();
                const oneDay = 1000 * 60 * 60 * 24;

                sortedTasks.forEach(task => {
                    const priorityBadgeClass = getPriorityBadgeClass(task.priority);
                    const taskDueDate = new Date(task.dueDate);
                    const diffTime = taskDueDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / oneDay);
                    
                    let daysRemainingText = '';
                    let daysRemainingClass = 'text-gray-700';
                    let rowClass = '';
                    let taskTitleClass = '';

                    // Determine the text and color for "Days Remaining" based on status and due date
                    if (task.status === 'Completed') {
                        daysRemainingText = 'Completed';
                        daysRemainingClass = 'text-green-600 font-medium';
                        taskTitleClass = 'line-through text-gray-500';
                    } else if (task.status === 'Bin') {
                        daysRemainingText = 'Cancelled';
                        daysRemainingClass = 'text-gray-500 font-medium';
                        taskTitleClass = 'line-through text-gray-500';
                        rowClass = 'opacity-60';
                    } else if (taskDueDate < today) {
                        daysRemainingText = 'Overdue';
                        daysRemainingClass = 'text-red-500 font-medium';
                    } else if (diffDays <= 7) {
                        daysRemainingText = `${diffDays} day${diffDays !== 1 ? 's' : ''}`;
                        daysRemainingClass = 'text-orange-500 font-medium';
                    } else {
                        daysRemainingText = `${diffDays} day${diffDays !== 1 ? 's' : ''}`;
                    }

                    const row = `
                        <tr class="hover:bg-gray-100 transition-colors duration-200 ${rowClass}">
                            <td class="px-6 py-4 font-medium text-gray-900">
                                <span class="${taskTitleClass}">${task.title}</span>
                                <p class="text-sm text-gray-600">${task.description}</p>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-700">${task.assignee || 'Unassigned'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-700">
                                ${formatDate(task.dueDate)}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap ${daysRemainingClass}">
                                ${daysRemainingText}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityBadgeClass}">
                                    ${task.priority}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <select data-id="${task.id}" class="status-select px-2 py-1 rounded text-sm bg-white border border-gray-300 text-gray-900">
                                    <option value="To Do" ${task.status === 'To Do' ? 'selected' : ''}>To Do</option>
                                    <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                    <option value="Completed" ${task.status === 'Completed' ? 'selected' : ''}>Completed</option>
                                    <option value="Bin" ${task.status === 'Bin' ? 'selected' : ''}>Bin</option>
                                </select>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                <button data-id="${task.id}" class="edit-btn text-sky-600 hover:text-sky-700">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button data-id="${task.id}" class="delete-btn text-red-600 hover:text-red-700">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    `;
                    taskList.insertAdjacentHTML('beforeend', row);
                });

                // Update sort arrows
                document.querySelectorAll('.sort-header').forEach(header => {
                    const arrowSpan = header.querySelector('.arrow');
                    if (header.dataset.sortBy === currentSortColumn) {
                        arrowSpan.innerHTML = sortDirection === 'asc' ? '&#9650;' : '&#9660;';
                    } else {
                        arrowSpan.innerHTML = '';
                    }
                });
            };

            // Handle form submission for adding a new task
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const title = document.getElementById('task-title').value.trim();
                const description = document.getElementById('task-description').value.trim();
                const dueDate = document.getElementById('task-due-date').value;
                const assignee = document.getElementById('task-assignee').value.trim();
                const priority = document.getElementById('task-priority').value;

                if (!title || !dueDate) {
                    // Using a message box instead of alert() for better UX
                    const showMessage = (message) => {
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
                        modal.innerHTML = `
                            <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-sm transform scale-100 transition-transform duration-300 ease-out">
                                <h3 class="text-xl font-bold text-gray-900 mb-4">Error</h3>
                                <p class="text-gray-700 mb-6">${message}</p>
                                <div class="flex justify-end gap-3">
                                    <button class="px-4 py-2 text-white bg-gray-700 rounded-lg hover:bg-gray-800 close-btn">OK</button>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(modal);
                        modal.querySelector('.close-btn').addEventListener('click', () => {
                            modal.remove();
                        });
                    };
                    showMessage('Please fill out the task title and due date.');
                    return;
                }
                
                const newTask = {
                    id: Date.now().toString(), // Simple unique ID
                    title,
                    description,
                    dueDate,
                    assignee,
                    priority,
                    status: 'To Do' // Default status
                };
                
                tasks.push(newTask);
                saveTasks();
                renderTasks();
                form.reset();
            });

            // Handle status change, delete, and edit button clicks using event delegation
            taskList.addEventListener('click', (e) => {
                // Delete button
                if (e.target.closest('.delete-btn')) {
                    const id = e.target.closest('.delete-btn').dataset.id;
                    taskToDeleteId = id;
                    deleteModal.classList.remove('hidden', 'opacity-0');
                    deleteModal.classList.add('flex', 'opacity-100');
                }
                // Edit button
                if (e.target.closest('.edit-btn')) {
                    const id = e.target.closest('.edit-btn').dataset.id;
                    taskToEditId = id;
                    const task = tasks.find(t => t.id === id);
                    if (task) {
                        document.getElementById('edit-task-title').value = task.title;
                        document.getElementById('edit-task-description').value = task.description;
                        document.getElementById('edit-task-due-date').value = task.dueDate;
                        document.getElementById('edit-task-assignee').value = task.assignee;
                        document.getElementById('edit-task-priority').value = task.priority;
                        
                        editModal.classList.remove('hidden', 'opacity-0');
                        editModal.classList.add('flex', 'opacity-100');
                    }
                }
            });

            // Event listener for status changes
            taskList.addEventListener('change', (e) => {
                if (e.target.classList.contains('status-select')) {
                    const id = e.target.dataset.id;
                    const newStatus = e.target.value;
                    const taskIndex = tasks.findIndex(task => task.id === id);
                    if (taskIndex !== -1) {
                        tasks[taskIndex].status = newStatus;
                        saveTasks();
                        renderTasks(); // Re-render to apply line-through style
                    }
                }
            });

            // Handle sorting on table header click
            document.querySelectorAll('.sort-header').forEach(header => {
                header.addEventListener('click', () => {
                    const sortBy = header.dataset.sortBy;
                    if (currentSortColumn === sortBy) {
                        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSortColumn = sortBy;
                        sortDirection = 'asc';
                    }
                    applyFilters(); // Re-render with new sort order
                });
            });

            // Handle filter and search input
            const applyFilters = () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const status = statusFilter.value;

                const filteredTasks = tasks.filter(task => {
                    const matchesSearch = task.title.toLowerCase().includes(searchTerm) ||
                                          task.description.toLowerCase().includes(searchTerm) ||
                                          task.assignee.toLowerCase().includes(searchTerm);
                    const matchesStatus = status === 'all' || task.status === status;
                    return matchesSearch && matchesStatus;
                });
                renderTasks(filteredTasks);
            };

            searchInput.addEventListener('input', applyFilters);
            statusFilter.addEventListener('change', applyFilters);

            // Handle delete modal buttons
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.classList.remove('opacity-100');
                deleteModal.classList.add('opacity-0');
                setTimeout(() => {
                    deleteModal.classList.add('hidden');
                    taskToDeleteId = null;
                }, 300); // Wait for transition
            });

            confirmDeleteBtn.addEventListener('click', () => {
                if (taskToDeleteId) {
                    tasks = tasks.filter(task => task.id !== taskToDeleteId);
                    saveTasks();
                    renderTasks();
                    
                    deleteModal.classList.remove('opacity-100');
                    deleteModal.classList.add('opacity-0');
                    setTimeout(() => {
                        deleteModal.classList.add('hidden');
                        taskToDeleteId = null;
                    }, 300); // Wait for transition
                }
            });

            // Handle edit modal buttons
            cancelEditBtn.addEventListener('click', () => {
                editModal.classList.remove('opacity-100');
                editModal.classList.add('opacity-0');
                setTimeout(() => {
                    editModal.classList.add('hidden');
                    taskToEditId = null;
                }, 300); // Wait for transition
            });

            editForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const taskIndex = tasks.findIndex(t => t.id === taskToEditId);
                if (taskIndex !== -1) {
                    tasks[taskIndex].title = document.getElementById('edit-task-title').value.trim();
                    tasks[taskIndex].description = document.getElementById('edit-task-description').value.trim();
                    tasks[taskIndex].dueDate = document.getElementById('edit-task-due-date').value;
                    tasks[taskIndex].assignee = document.getElementById('edit-task-assignee').value.trim();
                    tasks[taskIndex].priority = document.getElementById('edit-task-priority').value;

                    saveTasks();
                    renderTasks();

                    editModal.classList.remove('opacity-100');
                    editModal.classList.add('opacity-0');
                    setTimeout(() => {
                        editModal.classList.add('hidden');
                        taskToEditId = null;
                    }, 300);
                }
            });

            // Initial load
            loadTasks();
        });
    </script>
</body>
</html>
