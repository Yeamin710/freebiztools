<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <!-- Page description for SEO and clarity -->
    <meta name="description" content="A simple web-based invoice generator tool that allows you to create, edit, and download professional invoices as a PDF.">
    <!-- Use the Inter font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF and html2canvas for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <!-- Container for the "Back to Home" button to ensure it's always visible -->
    <div class="w-full mb-4">
        <a href="index.html"
           class="inline-block bg-gray-800 text-white py-2 px-4 rounded-md font-semibold
                  hover:bg-gray-900 transition duration-200 focus:outline-none focus:ring-2
                  focus:ring-gray-700 focus:ring-offset-2">
            Back to Home
        </a>
    </div>
    
    <!-- Visible Title and Description - Now outside the PDF generation area -->
    <div class="max-w-4xl mx-auto mb-8 text-center">
        <h2 class="text-3xl font-bold text-gray-800">Invoice Generator Tool</h2>
        <p class="mt-2 text-lg text-gray-600">Create professional invoices quickly and easily with this simple web-based tool.</p>
    </div>

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden p-6 sm:p-10">
        <!-- Invoice Header -->
        <header id="invoice-header" class="mb-8">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">INVOICE</h1>
                    <p class="text-sm text-gray-500 mt-1">#<input type="text" id="invoice-number" value="INV-001" class="w-24 border-b border-gray-300 focus:outline-none focus:border-blue-500 text-gray-600 font-medium"></p>
                </div>
                <!-- Company Details - Now Editable -->
                <div class="text-right">
                    <input type="text" id="company-name" value="Your Company" class="text-xl font-bold text-gray-800 text-right p-1 border-b border-gray-300 focus:outline-none focus:border-blue-500 w-full mb-1">
                    <textarea id="company-details" rows="3" class="w-full p-2 text-gray-600 text-sm text-right border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">123 Main Street
City, State, ZIP
your.email@example.com</textarea>
                </div>
            </div>
            <hr class="my-6 border-gray-200">
        </header>

        <!-- Billing and Dates Section -->
        <div id="invoice-details" class="grid grid-cols-1 sm:grid-cols-2 gap-8 mb-8">
            <div>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">BILL TO</h3>
                <input type="text" id="client-name" placeholder="Client Name" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                <textarea id="client-address" placeholder="Client Address" rows="3" class="block w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
            <div class="sm:text-right">
                <div class="flex flex-col sm:items-end">
                    <div class="mb-2">
                        <label for="invoice-date" class="block text-gray-600 font-medium">Invoice Date:</label>
                        <input type="date" id="invoice-date" class="w-full sm:w-auto p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="due-date" class="block text-gray-600 font-medium">Due Date:</label>
                        <input type="date" id="due-date" class="w-full sm:w-auto p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>
        </div>

        <!-- Line Items Table -->
        <div id="invoice-items" class="mb-8 overflow-x-auto">
            <table class="min-w-full bg-white rounded-lg shadow-sm">
                <thead>
                    <tr class="bg-gray-50 text-left text-gray-600 text-sm font-semibold">
                        <th class="py-3 px-4 rounded-tl-lg">Description</th>
                        <th class="py-3 px-4 text-center">Qty</th>
                        <th class="py-3 px-4 text-right">Price</th>
                        <th class="py-3 px-4 text-right rounded-tr-lg">Total</th>
                    </tr>
                </thead>
                <tbody id="item-list" class="text-gray-700">
                    <!-- Default item row -->
                    <tr class="item-row border-b last:border-b-0 border-gray-200">
                        <td class="py-3 px-4">
                            <input type="text" placeholder="Item description" class="w-full p-1 border-b border-gray-200 focus:outline-none focus:border-blue-400">
                        </td>
                        <td class="py-3 px-4 text-center">
                            <input type="number" value="1" min="1" class="quantity w-16 p-1 border-b border-gray-200 text-center focus:outline-none focus:border-blue-400">
                        </td>
                        <td class="py-3 px-4 text-right">
                            <input type="number" value="50.00" min="0" step="0.01" class="price w-24 p-1 border-b border-gray-200 text-right focus:outline-none focus:border-blue-400">
                        </td>
                        <td class="py-3 px-4 text-right total-cell font-medium">$50.00</td>
                    </tr>
                </tbody>
            </table>
            <!-- Updated button color -->
            <button id="add-item-btn" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 transition duration-200 ease-in-out shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-gray-400">
                + Add Item
            </button>
        </div>

        <!-- Summary and Totals -->
        <div id="invoice-summary" class="flex justify-end mb-8">
            <div class="w-full sm:w-1/2 lg:w-1/3">
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600 font-medium">Subtotal:</span>
                    <span id="subtotal" class="text-gray-800 font-semibold">$0.00</span>
                </div>
                <div class="flex justify-between items-center py-2 border-t border-gray-200">
                    <span class="text-gray-600 font-medium">Tax Rate (%):</span>
                    <input type="number" id="tax-rate" value="10" min="0" step="0.1" class="w-20 p-1 border-b border-gray-200 text-right focus:outline-none focus:border-blue-400">
                </div>
                <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600 font-medium">Tax:</span>
                    <span id="tax-amount" class="text-gray-800 font-semibold">$0.00</span>
                </div>
                <div class="flex justify-between items-center py-2 border-t border-gray-300">
                    <span class="text-xl font-bold text-gray-800">Total:</span>
                    <span id="total" class="text-xl font-bold text-gray-800">$0.00</span>
                </div>
            </div>
        </div>

        <!-- Call to Action -->
        <footer class="text-center">
            <button id="generate-pdf-btn" class="px-8 py-3 bg-gray-600 text-white text-lg font-bold rounded-xl hover:bg-gray-800 transition-all duration-200 ease-in-out shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-gray-300 transform hover:scale-105">
                Generate Invoice PDF
            </button>
        </footer>
    </div>

    <!-- JavaScript for functionality -->
    <script>
        window.onload = function() {
            // Get all necessary elements from the DOM
            const itemTable = document.getElementById('item-list');
            const addItemBtn = document.getElementById('add-item-btn');
            const generatePdfBtn = document.getElementById('generate-pdf-btn');
            const taxRateInput = document.getElementById('tax-rate');
            const subtotalSpan = document.getElementById('subtotal');
            const taxAmountSpan = document.getElementById('tax-amount');
            const totalSpan = document.getElementById('total');

            // Set current date and a future due date
            const today = new Date();
            const dueDate = new Date(today);
            dueDate.setDate(today.getDate() + 30);
            document.getElementById('invoice-date').valueAsDate = today;
            document.getElementById('due-date').valueAsDate = dueDate;

            // Function to calculate all totals
            function calculateTotals() {
                const itemRows = document.querySelectorAll('.item-row');
                let subtotal = 0;

                itemRows.forEach(row => {
                    const quantity = parseFloat(row.querySelector('.quantity').value);
                    const price = parseFloat(row.querySelector('.price').value);
                    const totalCell = row.querySelector('.total-cell');
                    const total = quantity * price;

                    if (!isNaN(total)) {
                        totalCell.textContent = `$${total.toFixed(2)}`;
                        subtotal += total;
                    }
                });

                const taxRate = parseFloat(taxRateInput.value) / 100;
                const taxAmount = subtotal * taxRate;
                const total = subtotal + taxAmount;

                subtotalSpan.textContent = `$${subtotal.toFixed(2)}`;
                taxAmountSpan.textContent = `$${taxAmount.toFixed(2)}`;
                totalSpan.textContent = `$${total.toFixed(2)}`;
            }

            // Function to add a new item row
            function addItemRow() {
                const newRow = document.createElement('tr');
                newRow.classList.add('item-row', 'border-b', 'last:border-b-0', 'border-gray-200');
                newRow.innerHTML = `
                    <td class="py-3 px-4">
                        <input type="text" placeholder="Item description" class="w-full p-1 border-b border-gray-200 focus:outline-none focus:border-blue-400">
                    </td>
                    <td class="py-3 px-4 text-center">
                        <input type="number" value="1" min="1" class="quantity w-16 p-1 border-b border-gray-200 text-center focus:outline-none focus:border-blue-400">
                    </td>
                    <td class="py-3 px-4 text-right">
                        <input type="number" value="0.00" min="0" step="0.01" class="price w-24 p-1 border-b border-gray-200 text-right focus:outline-none focus:border-blue-400">
                    </td>
                    <td class="py-3 px-4 text-right total-cell font-medium">$0.00</td>
                `;
                itemTable.appendChild(newRow);

                // Add event listeners to the new row's inputs
                const inputs = newRow.querySelectorAll('input.quantity, input.price');
                inputs.forEach(input => {
                    input.addEventListener('input', calculateTotals);
                });

                calculateTotals(); // Recalculate totals for the new item
            }

            // Function to generate the PDF
            async function generatePDF() {
                const element = document.querySelector('div.max-w-4xl.bg-white'); // Get the main container for the invoice

                // Use an array to store a reference to the newly created spans
                const generatedSpans = [];

                // Temporarily hide buttons and inputs for a cleaner PDF
                const interactiveElements = document.querySelectorAll('#add-item-btn, #generate-pdf-btn, input, textarea');
                interactiveElements.forEach(el => el.style.display = 'none');

                // Restore all inputs as static text
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => {
                    const span = document.createElement('span');
                    span.textContent = input.value;
                    if (input.id === 'company-name' || input.id === 'invoice-number') {
                        span.classList.add('font-bold', 'text-gray-800');
                    } else {
                        span.classList.add('font-medium', 'text-gray-700');
                    }
                    input.parentNode.insertBefore(span, input);
                    generatedSpans.push(span); // Add the span to our tracking array
                });

                // Handle the company-details textarea separately to preserve line breaks
                const companyDetailsTextarea = document.getElementById('company-details');
                const companyDetailsDiv = companyDetailsTextarea.parentElement;
                const companyDetailsLines = companyDetailsTextarea.value.split('\n');

                companyDetailsLines.forEach(line => {
                    const span = document.createElement('span');
                    span.textContent = line;
                    span.classList.add('text-gray-600', 'text-sm', 'text-right', 'block');
                    companyDetailsDiv.insertBefore(span, companyDetailsTextarea);
                    generatedSpans.push(span);
                });

                const totalCells = document.querySelectorAll('.total-cell');
                totalCells.forEach(cell => cell.classList.remove('font-medium'));

                // Use html2canvas to create an image of the element
                const canvas = await html2canvas(element, { scale: 2 });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
                const imgProps= pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('invoice.pdf');

                // Restore the original state of the page after generating the PDF
                interactiveElements.forEach(el => el.style.display = '');
                // Remove only the spans we created
                generatedSpans.forEach(span => span.remove());
                totalCells.forEach(cell => cell.classList.add('font-medium'));
            }

            // Event listeners
            addItemBtn.addEventListener('click', addItemRow);
            generatePdfBtn.addEventListener('click', generatePDF);
            
            // Add listeners to existing inputs
            document.querySelectorAll('input.quantity, input.price, #tax-rate').forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
            
            // Initial calculation
            calculateTotals();
        };
    </script>
</body>
</html>
